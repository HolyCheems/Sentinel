@model EagleEye.Views.ParkingLot.ParkingLot
@{
	Layout = "~/Views/ParkingLot/_ParkingLot.cshtml";
}
@section Buttons {
	<button class="btn btn-primary" onclick="editor.save()">Save</button>
	<button class="btn btn-default" onclick="editor.newSpace()">New Parking Space</button>
	<button class="btn btn-default" onclick="editor.newIsle()">New Isle</button>
}
<div id="viewport">
	<img id="baseline" />
	<canvas id="editor" />
</div>
@section scripts {
	<script>

	let img = document.getElementById('baseline');
	$.ajax({
		url: '/ParkingLot/Baseline',
		data: {id:@Model.ID}
	}).done(data => {
		img.src = `data:image/png;base64, ${data}`;
	});
	let editor = null;
	$.ajax({
		url: '/ParkingLot/Get',
		data: { id:@Model.ID}
	}).done(lot => {
		// Convert annotation points into Vector2 instances
		lot.Annotations.forEach(a => {
			let points = a.Points;
			a.Points = [];
			points.forEach(p => {
				a.Points.push(new Vector2(p.X, p.Y));
			})
		})

		editor = new AnnotationEditor(lot, document.getElementById('editor'));
	});
	</script>
}